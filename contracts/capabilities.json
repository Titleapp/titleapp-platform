{
  "version": "1.0.0",
  "lastUpdated": "2026-01-08",
  "rules": {
    "no_undeclared_endpoints": true,
    "chat_and_web_parity": true,
    "audit_and_event_required": true,
    "permission_matrix_is_source_of_truth": true,
    "lego_model_add_only": true
  },
  "kycLevels": ["KYC-0", "KYC-1", "KYC-2"],
  "tenantContexts": ["civilian", "tenant"],
  "callerTypes": ["human", "chat", "worker", "system"],
  "roles": [
    "owner_admin",
    "admin_ops",
    "agent_sales",
    "staff_standard",
    "auditor_readonly"
  ],
  "capabilities": [
    {
      "id": "identity.register_user_v1",
      "class": "identity",
      "summary": "Create a user account (email auth or SSO).",
      "contexts": ["civilian", "tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "identity.update_profile_v1",
      "class": "identity",
      "summary": "Update user profile fields (non-privileged).",
      "contexts": ["civilian", "tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "tenant.create_tenant_v1",
      "class": "tenant",
      "summary": "Create a tenant and set the creating user as owner_admin.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-1",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "tenant.invite_staff_v1",
      "class": "tenant",
      "summary": "Invite staff to tenant and assign roles.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "vertical.install_vertical_package_v1",
      "class": "vertical",
      "summary": "Install a vertical overlay package (real_estate, auto_dealer, etc.).",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "vertical.set_vertical_enabled_v1",
      "class": "vertical",
      "summary": "Enable or disable a vertical overlay for a tenant.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "leads.lead_capture_v1",
      "class": "leads",
      "summary": "Create a lead record from web form, chat, or integration.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat", "system"],
      "requiredKyc": "KYC-0",
      "requiredRoles": ["agent_sales", "staff_standard", "admin_ops", "owner_admin"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "leads.update_lead_state_v1",
      "class": "leads",
      "summary": "Move lead through the maturation state machine.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat", "worker"],
      "requiredKyc": "KYC-0",
      "requiredRoles": ["agent_sales", "staff_standard", "admin_ops", "owner_admin"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "leads.assign_sales_owner_v1",
      "class": "leads",
      "summary": "Assign lead ownership to a broker/agent/rep.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-1",
      "requiredRoles": ["agent_sales", "admin_ops", "owner_admin"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "leads.generate_daily_digest_v1",
      "class": "leads",
      "summary": "Generate daily lead digest for broker/manager.",
      "contexts": ["tenant"],
      "allowedCallers": ["worker", "system"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "docs.upload_rrl_doc_v1",
      "class": "docs",
      "summary": "Upload a Rules & Resources doc (contracts/SOPs/disclosures) with versioning.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "docs.list_rrl_docs_v1",
      "class": "docs",
      "summary": "List Rules & Resources docs available for a tenant/vertical.",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat", "worker"],
      "requiredKyc": "KYC-0",
      "requiredRoles": ["agent_sales", "staff_standard", "admin_ops", "owner_admin", "auditor_readonly"],
      "emitsEvent": false,
      "writesAudit": false
    },

    {
      "id": "drafts.generate_rrl_draft_v1",
      "class": "drafts",
      "summary": "Generate draft content from approved templates or client-supplied docs.",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "drafts.generate_sales_doc_v1",
      "class": "drafts",
      "summary": "Generate a draft offer/contract (explicitly marked Draft).",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-0",
      "requiredRoles": ["agent_sales", "owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "approvals.sales_doc_approve_v1",
      "class": "approvals",
      "summary": "Explicit approval of a draft for sending/execution (versioned).",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-1",
      "requiredRoles": ["owner_admin", "admin_ops", "agent_sales"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "kyc.verify_identity_v1",
      "class": "kyc",
      "summary": "Run or refresh KYC verification (annual reuse supported).",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "kyc.get_kyc_status_v1",
      "class": "kyc",
      "summary": "Return KYC status and expiry for current user.",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat", "worker", "system"],
      "requiredKyc": "KYC-0",
      "requiredRoles": [],
      "emitsEvent": false,
      "writesAudit": false
    },

    {
      "id": "dtc.create_dtc_record_v1",
      "class": "dtc",
      "summary": "Create DTC record in Firestore (pending_mint if on-chain enabled).",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-1",
      "requiredRoles": ["agent_sales", "admin_ops", "owner_admin"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "dtc.mint_dtc_venly_v1",
      "class": "dtc",
      "summary": "Asynchronous Venly minting worker (non-blocking).",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["worker", "system"],
      "requiredKyc": "KYC-1",
      "requiredRoles": [],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "token.create_token_v1",
      "class": "token",
      "summary": "Create and deploy a token (always KYC-gated).",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-1",
      "requiredRoles": ["owner_admin"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "billing.create_invoice_v1",
      "class": "billing",
      "summary": "Create an invoice or payment intent for a billable action.",
      "contexts": ["tenant", "civilian"],
      "allowedCallers": ["human", "chat", "system"],
      "requiredKyc": "KYC-0",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },

    {
      "id": "workers.create_worker_v1",
      "class": "workers",
      "summary": "Create an AI Worker configuration (not deployed).",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    },
    {
      "id": "workers.deploy_worker_v1",
      "class": "workers",
      "summary": "Deploy an AI Worker to production (gated, auditable).",
      "contexts": ["tenant"],
      "allowedCallers": ["human", "chat"],
      "requiredKyc": "KYC-2",
      "requiredRoles": ["owner_admin", "admin_ops"],
      "emitsEvent": true,
      "writesAudit": true
    }
  ]
}
